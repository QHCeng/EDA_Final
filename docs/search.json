[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "EDA Final Project on TEDS",
    "section": "",
    "text": "The Treatment Episode Data Set - Admissions (TEDS-A) provides rich, standardized data on individuals admitted to substance use treatment facilities across the United States. I chose this dataset because it offers a comprehensive view of the demographic, clinical, and socio-economic characteristics of individuals seeking help for substance use disorders. Substance use is a critical public health issue, with profound implications for individuals, families, and communities.\nBy analyzing this dataset, we are curious about uncovering patterns and trends in substance use and treatment access, which could help identify gaps in the system, informing public policy, and improving treatment outcomes. Meanwhile, what’s the common or even uncommon causes of typical type of abuses, and more insights for prevention, as well as the association between use of substance and all kinds of factors from individual scale to social scale are all our potential research, based on the analysis results.\nSome questions could be explored more:\n(Demographic Patterns) What are the demographic characteristics (e.g., age, gender, race) of individuals admitted to substance use treatment? Are there observable disparities in treatment access across different populations?\n(Substance Use Trends) What are the most commonly reported substances leading to treatment admission, and how do they vary by demographic factors? How does the age of first use correlate with the type and frequency of substance use?\n(Treatment and Outcomes) What are the most common types of treatment services provided, and how do they vary across regions? Does the use of medication-assisted treatments (MATs) differ based on the type of substance? Socio-Economic Correlations:\nMore context about this dataset: Substance use disorders (SUDs) affect millions of individuals worldwide. These disorders are characterized by an inability to control the use of substances despite adverse consequences. Commonly abused substances include alcohol, opioids, stimulants, and marijuana. The opioid crisis, in particular, has highlighted the urgent need for effective interventions.\nThe TEDS-A dataset, collected by the Substance Abuse and Mental Health Services Administration (SAMHSA), serves as a vital resource for understanding trends in substance use and treatment services. It includes data on admissions to state-licensed treatment facilities, focusing on factors such as demographics, substance use history, and the type of treatment received.\nAnalyzing this dataset provides insights into the scope of substance use issues and the efficacy of current treatment approaches. This understanding can support efforts to design better-targeted interventions, allocate resources more effectively, and reduce the societal burden of substance use disorders.\nPersonal Motivation: I am particularly interested in this topic because of its direct relevance to public health and the opportunity it provides to use data-driven approaches to address real-world challenges. The interplay between socio-economic factors, demographic characteristics, and substance use patterns fascinates me, as it offers a window into systemic inequalities and areas for improvement in healthcare delivery.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>index.html</span>"
    ]
  },
  {
    "objectID": "data.html",
    "href": "data.html",
    "title": "EDA Final Project on TEDS",
    "section": "",
    "text": "The data we use in this project is TEDS-A dataset, and the time period we use is year 2021. The link for this dataset is https://www.samhsa.gov/data/data-we-collect/teds/datafiles.\nFor this project, we propose using the Treatment Episode Data Set - Admissions (TEDS-A), 2021, which is managed by the Substance Abuse and Mental Health Services Administration (SAMHSA). This dataset exclusively contains records of substance use treatment admissions that occurred in the year 2021 across the United States. The data is collected by state agencies from state-licensed or certified treatment centers that receive public funding. It encompasses both administrative details and self-reported information from individuals at the time of admission, making it a valuable resource for studying substance use treatment trends.\nThe dataset is provided in multiple formats, including SAS, SPSS, Stata, R, and ASCII comma-delimited files, ensuring compatibility with diverse analytical tools. The availability of the dataset in R format facilitates efficient analysis within RStudio, which will be used for this project. The 2021 dataset contains 1,482,543 records, each corresponding to a unique treatment admission. The key variables include demographic information such as age, gender, and race; substance use details like primary, secondary, and tertiary substances; and service-related attributes such as referral source and type of treatment received.\nFor processing and analysis, we will exclusively use R. We plan to utilize the tidyverse suite of packages for data cleaning, manipulation, and visualization. The haven package will be used to import the dataset, allowing seamless handling of SPSS or Stata formats. Additionally, dplyr will be employed for filtering, grouping, and summarizing the data, while ggplot2 will be used to visualize trends and relationships. Comprehensive documentation provided by SAMHSA, including user manuals and crosswalks, will ensure that variables are accurately interpreted and used appropriately in the analysis. The dataset and its documentation are publicly available through SAMHSA’s official data portal.\n\n\nCode\nload(\"data/rawdata.rdata\")\n\n\n\n\nCode\nlibrary(haven)\n\ntedsa_puf_2021_r &lt;- as.data.frame(lapply(tedsa_puf_2021_r, function(col) {\n  if (inherits(col, \"haven_labelled\")) {\n    haven::as_factor(col)  \n  } else {\n    col\n  }\n}))\n\ntedsa_puf_2021_r[tedsa_puf_2021_r == -9] &lt;- NA\n\n\nWhile the TEDS-A dataset provides extensive coverage of treatment admissions in 2021, it has several limitations due to missing or incomplete data. Some variables contain a significant proportion of missing values, invalid, or uncollected data. For example, employment status has 17.0% missing data, likely reflecting cases where the information was unavailable or not collected. Similarly, frequency of substance use for primary substances has 18.8% missing values. These missing data points can pose challenges for analysis by reducing the reliability of certain conclusions.\n\n\nCode\nlibrary(ggplot2)\nlibrary(dplyr)\n\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\n\nCode\ncalculate_proportions &lt;- function(data, column) {\n  data |&gt;\n    group_by(across(all_of(column))) |&gt;\n    summarise(count = n(), .groups = \"drop\") |&gt;\n    mutate(proportion = count / sum(count) * 100,\n           variable = column)\n}\n\nvariables &lt;- c(\"EMPLOY\", \"FREQ1\")\n\nfor (var in variables) {\n  plot_data &lt;- calculate_proportions(tedsa_puf_2021_r, var)\n  \n  plot &lt;- ggplot(plot_data, aes_string(x = var, y = \"proportion\", fill = var)) +\n    geom_bar(stat = \"identity\", position = \"dodge\") +\n    labs(title = paste(\"Proportions of Categories in\", var), \n         x = \"Category\", \n         y = \"Proportion (%)\") +\n    theme_minimal(base_size = 14) +\n    theme(axis.text.x = element_text(angle = 45, hjust = 1))\n  \n  print(plot)\n}\n\n\nWarning: `aes_string()` was deprecated in ggplot2 3.0.0.\nℹ Please use tidy evaluation idioms with `aes()`.\nℹ See also `vignette(\"ggplot2-in-packages\")` for more information.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCode\nlibrary(redav)\nlibrary(ggplot2)\n\ncols_to_keep &lt;- c(\"AGE\", \"GENDER\", \"RACE\", \"MARSTAT\", \"EDUC\", \"EMPLOY\", \"LIVARAG\", \"SERVICES\", \n                  \"METHUSE\", \"DAYWAIT\", \"SUB1\", \"FREQ1\", \"FRSTUSE1\", \"DSMCRIT\")\ntedsa_puf_2021_r_new &lt;- tedsa_puf_2021_r[ , cols_to_keep]\n\nplot_missing(tedsa_puf_2021_r_new, max_rows=5, max_cols=7)\n\n\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\n\n\n\n\n\n\n\n\n\n\nCode\nlibrary(naniar)\nlibrary(ggplot2)\n\nmissing_summary &lt;- colSums(is.na(tedsa_puf_2021_r_new)) / nrow(tedsa_puf_2021_r_new) * 100\nmissing_data &lt;- data.frame(\n  Variable = names(missing_summary),\n  MissingPercentage = missing_summary\n)\n\nggplot(missing_data, aes(x = reorder(Variable, -MissingPercentage), y = MissingPercentage, fill = Variable)) +\n  geom_bar(stat = \"identity\", show.legend = FALSE) +\n  labs(\n    title = \"Missing Data Distribution by Variable\",\n    x = \"Variable\",\n    y = \"Missing Percentage (%)\"\n  ) +\n  theme_minimal(base_size = 14) +\n  theme(\n    axis.text.x = element_text(size = 10, angle = 45, hjust = 1), \n    axis.text.y = element_text(size = 8) \n  )\n\n\n\n\n\n\n\n\n\nTo address missing data, we will use a systematic approach within R. For categorical variables like pregnancy status and employment status, we will create a separate category for missing values. This ensures that missing data is accounted for without distorting distributions through imputation. For numerical variables, such as age at first use or days waiting for treatment, we will analyze patterns of missingness and decide on appropriate imputation methods. For instance, if the missing values are randomly distributed, we may use the median or mode for imputation. However, for variables where more than 50% of values are missing, such as detailed criminal justice referral, these variables may be excluded from certain analyses to prevent introducing bias.\nHandling missing data will rely on R packages like tidyr and mice for managing and imputing missing values. Visual tools from ggplot2 will help identify patterns in missingness and validate the chosen methods. This comprehensive approach ensures that missing data is appropriately managed without compromising the quality or integrity of the analysis. By leveraging the flexibility and analytical power of R, we aim to effectively mitigate the impact of missing data while maintaining the dataset’s analytical utility.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>data.html</span>"
    ]
  },
  {
    "objectID": "data.html#missing-value-analysis",
    "href": "data.html#missing-value-analysis",
    "title": "2  Data",
    "section": "2.2 Missing value analysis",
    "text": "2.2 Missing value analysis\nWhile the TEDS-A dataset provides extensive coverage of treatment admissions in 2021, it has several limitations due to missing or incomplete data. Some variables contain a significant proportion of missing values, coded as -9 to denote unknown, invalid, or uncollected data. For example, the pregnancy status variable is missing for 68.8% of cases, primarily because this variable is not applicable to male clients. Employment status has 17.0% missing data, likely reflecting cases where the information was unavailable or not collected. Similarly, frequency of substance use for primary substances has 18.8% missing values. These missing data points can pose challenges for analysis by reducing the reliability of certain conclusions.\nAdditionally, reporting practices vary across states, which can lead to discrepancies. For instance, some states exclude data from private or hospital-based facilities, while others omit specific populations such as those in correctional institutions. These differences must be considered when interpreting the dataset, as they may affect representativeness and comparability between states.\nTo address missing data, we will use a systematic approach within R. For categorical variables like pregnancy status and employment status, we will create a separate category for missing values. This ensures that missing data is accounted for without distorting distributions through imputation. For numerical variables, such as age at first use or days waiting for treatment, we will analyze patterns of missingness and decide on appropriate imputation methods. For instance, if the missing values are randomly distributed, we may use the median or mode for imputation. However, for variables where more than 50% of values are missing, such as detailed criminal justice referral, these variables may be excluded from certain analyses to prevent introducing bias.\nHandling missing data will rely on R packages like tidyr and mice for managing and imputing missing values. Visual tools from ggplot2 will help identify patterns in missingness and validate the chosen methods. This comprehensive approach ensures that missing data is appropriately managed without compromising the quality or integrity of the analysis. By leveraging the flexibility and analytical power of R, we aim to effectively mitigate the impact of missing data while maintaining the dataset’s analytical utility.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Data</span>"
    ]
  },
  {
    "objectID": "results.html",
    "href": "results.html",
    "title": "3  Results",
    "section": "",
    "text": "Code\nlibrary(ggplot2)\nlibrary(dplyr)\n\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\n\nCode\nlibrary(forcats)\nlibrary(ggalluvial)\nlibrary(RColorBrewer)\nlibrary(scales)\nlibrary(vcd)\n\n\nLoading required package: grid\n\n\nCode\nlibrary(grid)\n\ndata &lt;- read.csv(\"./data/data_clean.csv\", stringsAsFactors = TRUE)\n\n\nExplanation of variables:MARSTAT is the marriage status, LIVARAG is Living arrangements SERVICE is Type of treatment service/setting, METHUSE is whether the use of opioid medications, DSMCRIT is the reason for a client’s encounter or treatment\n\n\nCode\nhead(data)\n\n\n              AGE GENDER                                  RACE       MARSTAT\n1 30-34 years old   Male Alaska Native (Aleut, Eskimo, Indian)   Now married\n2 15-17 years old Female                                 White Never married\n3 30-34 years old Female Alaska Native (Aleut, Eskimo, Indian) Never married\n4 25-29 years old Female                                 White   Now married\n5 25-29 years old Female                     Other single race Never married\n6 25-29 years old Female             Black or African American Never married\n                                                    EDUC             EMPLOY\n1 1-3 years of college, university, or vocational school Not in labor force\n2                                         Grades 9 to 11 Not in labor force\n3 1-3 years of college, university, or vocational school         Unemployed\n4                                         Grades 9 to 11 Not in labor force\n5                                         Grades 9 to 11 Not in labor force\n6                                      Grade 12 (or GED) Not in labor force\n             LIVARAG                                         SERVICES METHUSE\n1   Dependent living Rehab/residential, long term (more than 30 days)      No\n2   Dependent living Rehab/residential, long term (more than 30 days)      No\n3 Independent living             Ambulatory, non-intensive outpatient      No\n4 Independent living             Ambulatory, non-intensive outpatient     Yes\n5 Independent living             Ambulatory, non-intensive outpatient     Yes\n6   Dependent living             Ambulatory, non-intensive outpatient      No\n  DAYWAIT              SUB1                    FREQ1           FRSTUSE1\n1       0           Alcohol No use in the past month        18-20 years\n2       0 Marijuana/hashish                Daily use 11 years and under\n3       0 Marijuana/hashish                Daily use        15-17 years\n4       0            Heroin                Daily use        18-20 years\n5       0            Heroin                Daily use        18-20 years\n6       0           Alcohol                 Some use        12-14 years\n              DSMCRIT\n1  Alcohol dependence\n2 Cannabis dependence\n3  Alcohol dependence\n4   Opioid dependence\n5   Opioid dependence\n6  Alcohol dependence\n\n\nFirst we want to see the basic distribution for the age of data:\n\n\nCode\nggplot(data, aes(x = AGE)) + \n  geom_bar(stat = \"count\", fill = \"skyblue\") + \n  geom_text(stat = \"count\", aes(label = after_stat(count)), vjust = -0.3) +\n  theme_minimal() +\n  labs(x = \"Age\", y = \"Count\")+\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n\n\n\n\n\n\n\n\n\nFrom which we can see most of individuals are within 18-64 age. And gender:\n\n\nCode\nggplot(data, aes(x = GENDER)) + \n  geom_bar(stat = \"count\", fill = \"#FF5733\") + \n  geom_text(stat = \"count\", aes(label = after_stat(count)), vjust = -0.3) +\n  theme_minimal() +\n  labs(x = \"Gender\", y = \"Count\")\n\n\n\n\n\n\n\n\n\nThe variable SUB1 identifies the client’s primary substance abuse at admission. The basic distribution is:\n\n\nCode\ndata$SUB1 &lt;- fct_infreq(data$SUB1)\nggplot(data, aes(x = SUB1)) + \n  geom_bar(stat = \"count\", fill = \"skyblue\") + \n  geom_text(stat = \"count\", aes(label = after_stat(count)), vjust = -0.3) +\n  theme_minimal() +\n  labs(x = \"Substance\", y = \"Count\")+\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n\n\n\n\n\n\n\n\n\n\n\nCode\ndata_top4_all &lt;- data |&gt;\n  mutate(across(everything(), ~ {\n    top4 &lt;- names(sort(table(.x), decreasing = TRUE))[1:4]\n    ifelse(.x %in% top4, as.character(.x), NA)\n  }))\n\n\n\n\nCode\nmosaic(~ EMPLOY + SUB1, \n       data = data_top4_all,\n       direction = c(\"v\", \"h\"),  \n       gp_labels = gpar(fontsize = 7),\n       gp_varnames = gpar(fontsize = 9),\n       main_gp = gpar(fontsize = 15),\n       labeling_args = list(\n         set_varnames = c(EMPLOY = \"EMPLOY\", SUB1 = \"Substances\"),\n         rot_labels = c(left = 0)\n         ),\n       margins = unit(c(1, 1, 1, 5), \"lines\"),\n       gp = gpar(fill = c(\"lightblue\", \"lightblue\", \"lightblue\", \"lightblue\", \n                          \"lightpink\", \"lightpink\", \"lightpink\", \"lightpink\",\n                          \"peachpuff1\", \"peachpuff1\", \"peachpuff1\", \"peachpuff1\",\n                          \"lightgreen\", \"lightgreen\", \"lightgreen\", \"lightgreen\"))\n)\n\n\n\n\n\n\n\n\n\nFor the clearance of the mosaic plot, we will only consider the top 4 categories for Employ and substances. From this plot, it can be seen that except alcohol seems to have an obviously larger proportion in Full-time category, other proportions seem similar in the mosaic plot. However, we still need to use the stacked bar chat to check if the total amount of substance usage corresponds with employment status.\n\n\nCode\nggplot(data, aes(x = EMPLOY, fill = SUB1)) +\n  geom_bar(position = \"stack\") +\n  labs(\n    x = \"EMPLOY\",\n    y = \"Count\"\n  ) +\n  scale_y_continuous(labels = comma) +\n  scale_fill_discrete(name = NULL) +\n  guides(fill = guide_legend(ncol = 2)) +\n  theme_minimal(base_size = 14) +\n  theme(\n    axis.text.x = element_text(angle = 60, hjust = 1, size = 8),\n    legend.text = element_text(size = 8),\n    legend.title = element_text(size = 10),\n  )\n\n\n\n\n\n\n\n\n\nThe stacked bar chart illustrates how the primary substance used varies across different employment status. It is not surprising that Unemployed corresponds to the highest number of substances used. However, it is surprising that Part-time has the lowest substance usage, and the usage is much lower than all other categories. We guess this may be correlated with working pressure, since Full-time and Not in labor force may have much higher working pressure than part-time.\n\n\nCode\ntable_1 &lt;- table(data$EMPLOY, data$SUB1)\ndf_table_1 &lt;- as.data.frame(table_1)\ncolnames(df_table_1) &lt;- c(\"EMPLOY\", \"SUB1\", \"Freq\")\n\n\n\n\nCode\nggplot(df_table_1, aes(x = EMPLOY, y = SUB1, fill = Freq)) +\n  geom_tile(color = \"white\") + \n  scale_fill_gradient(low = \"white\", high = \"steelblue\") +\n  labs(\n    x = \"EMPLOY\",\n    y = \"Substances\",\n    fill = \"Count\"\n  ) +\n  theme_minimal(base_size = 14) +\n  theme(\n    panel.grid = element_blank(),\n    axis.text.x = element_text(size = 8)\n  )\n\n\n\n\n\n\n\n\n\nFrom the heatmap, we can see that certain substances, such as Alcohol and Heroin, have relatively higher counts among the Unemployed and Not in labor force groups compared to others. In contrast, categories like Cocaine/crack or Barbiturates are used less frequently across all employment categories, resulting in lighter-colored cells. Also, it can be seen that the density for Part-time are low for all substances.\n\n\nCode\nmosaic(~ RACE + SUB1, \n       data = data_top4_all,\n       direction = c(\"v\", \"h\"),  \n       gp_labels = gpar(fontsize = 7),\n       gp_varnames = gpar(fontsize = 9),\n       main_gp = gpar(fontsize = 15),\n       labeling_args = list(\n         set_varnames = c(RACE = \"RACE\", SUB1 = \"Substances\"),\n         rot_labels = c(left = 0, top = 20)\n         ),\n       margins = unit(c(1, 1, 1, 5), \"lines\"),\n       gp = gpar(fill = c(\"lightblue\", \"lightblue\", \"lightblue\", \"lightblue\", \n                          \"lightpink\", \"lightpink\", \"lightpink\", \"lightpink\",\n                          \"peachpuff1\", \"peachpuff1\", \"peachpuff1\", \"peachpuff1\",\n                          \"lightgreen\", \"lightgreen\", \"lightgreen\", \"lightgreen\"))\n)\n\n\n\n\n\n\n\n\n\nFor the clearance of the mosaic plot, we will only consider the top 4 categories for Race and substances. From this plot, it can be seen that alcohol seems to have an obviously larger proportion in American Indian (other than Alaska Native) category and heroin has an obviously smaller proportion in American Indian (other than Alaska Native). In White, heroin has a smaller proportion compare to Black or African American and Other single race. Therefore, we think there is some correlation between RACE and Substance usage, and we can still use the stacked bar chat to check if the total amount of substance usage corresponds with race.\n\n\nCode\nggplot(data, aes(x = RACE, fill = SUB1)) +\n  geom_bar(position = \"stack\") +\n  labs(\n    x = \"RACE\",\n    y = \"Count\"\n  ) +\n  scale_fill_discrete(name = NULL) +\n  guides(fill = guide_legend(ncol = 2)) +\n  theme_minimal(base_size = 14) +\n  theme(\n    axis.text.x = element_text(angle = 60, hjust = 1, size = 8),\n    legend.text = element_text(size = 8),\n    legend.title = element_text(size = 10),\n  )\n\n\n\n\n\n\n\n\n\nThe stacked bar chart illustrates how the primary substance used varies across different races. White stands out with the highest overall substance counts and the broadest variety of substances. Black or African American follows, with fewer counts but still a noticeable presence of several key substances. The group identified as American Indian (other than Alaska Native) ranks third, showing less but still noticeable use use of substances.\n\n\nCode\ntable_2 &lt;- table(data$RACE, data$SUB1)\ndf_table_2 &lt;- as.data.frame(table_2)\ncolnames(df_table_2) &lt;- c(\"RACE\", \"SUB1\", \"Freq\")\n\n\n\n\nCode\nggplot(df_table_2, aes(x = RACE, y = SUB1, fill = Freq)) +\n  geom_tile(color = \"white\") + \n  scale_fill_gradient(low = \"white\", high = \"steelblue\") +\n  labs(\n    x = \"RACE\",\n    y = \"Substances\",\n    fill = \"Count\"\n  ) +\n  theme_minimal(base_size = 14) +\n  theme(\n    panel.grid = element_blank(),\n    axis.text.x = element_text(angle = 45, hjust = 1, size = 8)\n  )\n\n\n\n\n\n\n\n\n\nFrom the heat map, the “White” category shows significantly high usage levels for certain substances, whereas many other racial groups exhibit lighter-shaded cells, indicating lower frequencies.\n\n\nCode\ntop_sub1 &lt;- data |&gt;\n  count(SUB1, sort = TRUE) |&gt;\n  slice_head(n = 3) |&gt;\n  pull(SUB1)\n\ndata_top4_sub &lt;- data |&gt;\n  filter(SUB1 %in% top_sub1)\n\ndata_top4_sub &lt;- data_top4_sub |&gt; droplevels()\n\n\n\n\nCode\nmosaic(~ AGE + SUB1, \n       data = data_top4_sub,\n       direction = c(\"v\", \"h\"),  \n       gp_labels = gpar(fontsize = 6),\n       gp_varnames = gpar(fontsize = 9),\n       main_gp = gpar(fontsize = 15),\n       labeling_args = list(\n         set_varnames = c(AGE = \"AGE\", SUB1 = \"Substances\"),\n         rot_labels = c(left = 0, top = 30)\n         ),\n       margins = unit(c(1, 1, 1, 5), \"lines\"),\n       gp = gpar(fill = c(\"lightblue\", \"lightblue\", \"lightblue\", \"lightblue\", \"lightblue\", \"lightblue\", \"lightblue\", \"lightblue\", \"lightblue\", \"lightblue\", \"lightblue\", \"lightblue\",\n                          \"lightpink\", \"lightpink\", \"lightpink\", \"lightpink\", \"lightpink\", \"lightpink\", \"lightpink\", \"lightpink\", \"lightpink\", \"lightpink\", \"lightpink\", \"lightpink\",\n                          \"peachpuff1\", \"peachpuff1\", \"peachpuff1\", \"peachpuff1\", \"peachpuff1\", \"peachpuff1\", \"peachpuff1\", \"peachpuff1\", \"peachpuff1\", \"peachpuff1\", \"peachpuff1\", \"peachpuff1\",\n                          \"lightgreen\", \"lightgreen\", \"lightgreen\", \"lightgreen\", \"lightgreen\", \"lightgreen\", \"lightgreen\", \"lightgreen\", \"lightgreen\", \"lightgreen\", \"lightgreen\", \"lightgreen\"))\n)\n\n\n\n\n\n\n\n\n\nFor the clearance of the mosaic plot, we will only consider the top 4 categories for substances. From this plot, it can be seen that alcohol seems to have a larger proportion with the growth of age. Methamphetamine/speed and Other oplates and synthetics seems to have a smaller proportion with the growth of age. Therefore, we think age and substances usage are dependent.\n\n\nCode\nggplot(data, aes(x = AGE, fill = SUB1)) +\n  geom_bar(position = \"stack\") +\n  labs(\n    x = \"AGE\",\n    y = \"Count\"\n  ) +\n  scale_fill_discrete(name = NULL) +\n  guides(fill = guide_legend(ncol = 2)) +\n  theme_minimal(base_size = 14) +\n  theme(\n    axis.text.x = element_text(angle = 45, hjust = 1, size = 10),\n    legend.text = element_text(size = 8),\n    legend.title = element_text(size = 10)\n  )\n\n\n\n\n\n\n\n\n\nThe stacked bar chart illustrates how the primary substance used varies across different age groups. The middle-age ranges (around 30–39 years old) show the highest counts and a diverse mix of substances. Younger age groups (e.g., 12–20 years old) have lower overall counts, with fewer substance types represented. Older age groups (50 years and above) still demonstrate a variety of substances, but each substance tends to make up a smaller proportion compared to the middle-aged peak. This suggests that the middle-age range may be a period of particularly high diversity and intensity of substance use, while both younger and older groups show more limited but still distinct patterns of substance preferences.\n\n\nCode\ntable_3 &lt;- table(data$AGE, data$SUB1)\ndf_table_3 &lt;- as.data.frame(table_3)\ncolnames(df_table_3) &lt;- c(\"AGE\", \"SUB1\", \"Freq\")\n\n\n\n\nCode\nggplot(df_table_3, aes(x = AGE, y = SUB1, fill = Freq)) +\n  geom_tile(color = \"white\") + \n  scale_fill_gradient(low = \"white\", high = \"steelblue\") +\n  labs(\n    x = \"AGE\",\n    y = \"Substances\",\n    fill = \"Count\"\n  ) +\n  theme_minimal(base_size = 14) +\n  theme(\n    panel.grid = element_blank(),\n    axis.text.x = element_text(angle = 45, hjust = 1, size = 8)\n  )\n\n\n\n\n\n\n\n\n\nFrom the heat map, among all substances, alcohol, heroin, Marijuana/hashish, Methamphetamine/speed, and Other opiates and synthetics are substances that are used the most. Also, age range from around 25 to 65 are the range that has most substances usage.\n\n\nCode\nset.seed(123) \nsample_size &lt;- floor(0.005 * nrow(data))\nsample_data &lt;- data[sample(nrow(data), size = sample_size), ]\n\ntop_educ &lt;- sample_data |&gt;\n  count(EDUC, sort = TRUE) |&gt;\n  slice_head(n = 3) |&gt;\n  pull(EDUC)\n\ntop_sub1 &lt;- sample_data |&gt;\n  count(SUB1, sort = TRUE) |&gt;\n  slice_head(n = 4) |&gt;\n  pull(SUB1)\n\nsample_data_sub &lt;- sample_data |&gt;\n  filter(EDUC %in% top_educ, SUB1 %in% top_sub1)\n\n\n\n\nCode\nggplot(sample_data_sub, \n       aes(axis1 = GENDER, axis2 = EDUC, axis3 = SUB1, y = 1, fill = EDUC)) +\n  geom_alluvium(width = 1/12, knot.pos = 0.5, alpha = 0.7) +\n  geom_stratum(width = 1/12, color = \"black\") +\n  geom_text(stat = \"stratum\", aes(label = after_stat(stratum)), size = 3) +\n  scale_x_discrete(labels = c(\"GENDER\", \"EDUC\", \"SUB1\")) +\n  scale_fill_brewer(palette = \"Dark2\") +\n  labs(\n    x = \"Variables\",\n    y = NULL\n  ) +\n  theme_minimal() +\n  theme(\n    axis.text.y = element_blank(),\n    axis.ticks = element_blank(),\n    legend.position = \"none\"\n  )\n\n\n\n\n\n\n\n\n\nFor the convenience of calculation and the clearance of the graph, we randomly selected 0.5% of the data, select top 3 categories of EDUC and top 4 categories of SUB1.\nFrom the alluvial diagram, it can be observed that the distribution of educational attainment is quite similar between females and males, indicating that education level does not differ significantly by gender. At the same time, although the highest level of education is less common in the Marijuana/hashish category, the overall distribution of educational attainment across different substances is still quite similar. Overall, from the alluvia diagram suggests that neither gender nor educational background has a substantial impact on substance usage patterns, as the distribution appears uniform across all categories.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Results</span>"
    ]
  }
]